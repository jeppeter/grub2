From 88c9657960a6c5d3673a25c266781e876c181add Mon Sep 17 00:00:00 2001
From: Hector Marco-Gisbert <hecmargi@upv.es>
Date: Fri, 13 Nov 2015 16:21:09 +0100
Subject: [PATCH] Fix security issue when reading username and password

  This patch fixes two integer underflows at:
    * grub-core/lib/crypto.c
    * grub-core/normal/auth.c

Resolves: CVE-2015-8370

Signed-off-by: Hector Marco-Gisbert <hecmargi@upv.es>
Signed-off-by: Ismael Ripoll-Ripoll <iripoll@disca.upv.es>
---
 grub-core/lib/crypto.c  | 2 +-
 grub-core/normal/auth.c | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

Index: grub2-2.02~beta2/grub-core/lib/crypto.c
===================================================================
--- grub2-2.02~beta2.orig/grub-core/lib/crypto.c	2015-12-15 08:45:31.307836075 -0500
+++ grub2-2.02~beta2/grub-core/lib/crypto.c	2015-12-15 08:45:31.303836031 -0500
@@ -456,7 +456,7 @@
 	  break;
 	}
 
-      if (key == '\b')
+      if (key == '\b' && cur_len)
 	{
 	  cur_len--;
 	  continue;
Index: grub2-2.02~beta2/grub-core/normal/auth.c
===================================================================
--- grub2-2.02~beta2.orig/grub-core/normal/auth.c	2015-12-15 08:45:31.307836075 -0500
+++ grub2-2.02~beta2/grub-core/normal/auth.c	2015-12-15 08:45:31.303836031 -0500
@@ -172,7 +172,7 @@
 	  break;
 	}
 
-      if (key == '\b')
+      if (key == '\b' && cur_len)
 	{
 	  cur_len--;
 	  grub_printf ("\b");
